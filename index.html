<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>√ìpera Mar√≠tim ¬∑ Ruleta de Premios</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Google Fonts -->
  <link 
    href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;600&display=swap"
    rel="stylesheet"
  />

  <!-- Winwheel.js (para la animaci√≥n de ruleta) -->
  <script src="https://cdn.jsdelivr.net/gh/zarocknz/javascript-winwheel@2.7.0/Winwheel.min.js"></script>
  <!-- EmailJS (para env√≠o de emails) -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

  <style>
    :root {
      --oro: #caa86f;
      --negro: #111;
      --blanco: #f8f8f8;
    }

    /* ===== RESET & BOX-SIZING ===== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    /* ===== BODY Y FONDO ===== */
    body {
      font-family: 'Montserrat', sans-serif;
      background-color: var(--negro);
      color: var(--blanco);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      background-image: url('https://operamaritim.com/wp-content/uploads/2025/01/fondo-textura-opera.jpg');
      background-size: cover;
      background-position: center;
    }

    /* ===== CONTENEDOR PRINCIPAL ===== */
    .container {
      max-width: 600px;
      width: 90%;
      background-color: rgba(17, 17, 17, 0.9);
      border-radius: 12px;
      border: 1px solid var(--oro);
      box-shadow: 0 0 30px rgba(202, 168, 111, 0.3);
      padding: 30px 20px;
      margin: 20px auto;
    }

    /* ===== LOGO ===== */
    .logo {
      width: 180px;
      margin-bottom: 20px;
    }

    /* ===== T√çTULO ===== */
    .title {
      font-family: 'Playfair Display', serif;
      font-size: 24px;
      color: var(--oro);
      letter-spacing: 2px;
      margin-bottom: 30px;
    }

    /* ===== SECCI√ìN DE EMAIL ===== */
    #emailSection p {
      margin-bottom: 10px;
      font-size: 16px;
      color: var(--blanco);
    }
    .email-input {
      width: 80%;
      padding: 12px;
      margin-bottom: 15px;
      border: 2px solid var(--oro);
      border-radius: 4px;
      background: rgba(0, 0, 0, 0.2);
      color: var(--blanco);
      font-size: 16px;
    }

    /* ===== BOT√ìN ===== */
    .spin-btn {
      background-color: var(--oro);
      color: var(--negro);
      border: none;
      padding: 15px 40px;
      font-size: 18px;
      font-weight: bold;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'Playfair Display', serif;
      letter-spacing: 1px;
      margin-top: 10px;
    }
    .spin-btn:hover {
      background-color: #d8b878;
      transform: scale(1.05);
    }

    /* ===== RUEDA ===== */
    .wheel-container {
      position: relative;
      width: 400px;
      height: 400px;
      margin: 0 auto 20px auto;
    }
    /* Tri√°ngulo dorado del puntero */
    .pointer {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-bottom: 30px solid var(--oro);
      z-index: 2;
    }
    /* Canvas redondo con sombra */
    canvas {
      background: radial-gradient(#222, #111);
      border-radius: 50%;
      box-shadow: 0 0 0 8px var(--oro), 0 0 20px rgba(202, 168, 111, 0.6);
    }

    /* ===== TEXTO DE DESCARGO ===== */
    .disclaimer {
      font-size: 12px;
      color: #aaa;
      margin-top: 20px;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Logo √ìpera Mar√≠tim -->
    <img
      src="https://operamaritim.com/wp-content/uploads/2025/01/logotipo-opera-maritim-blanco.png"
      alt="√ìpera Mar√≠tim"
      class="logo"
    />

    <!-- T√≠tulo -->
    <h1 class="title">¬°Gira y descubre tu premio!</h1>

    <!-- SECCI√ìN 1: PEDIR EMAIL -->
    <div id="emailSection">
      <p>Introduce tu email para participar:</p>
      <input
        type="email"
        id="userEmail"
        class="email-input"
        placeholder="tucorreo@ejemplo.com"
      />
      <button class="spin-btn" onclick="verifyEmail()">CONTINUAR</button>
    </div>

    <!-- SECCI√ìN 2: RUEDA (oculta hasta validar email) -->
    <div id="wheelSection" style="display: none;">
      <div class="wheel-container">
        <div class="pointer"></div>
        <canvas id="canvas" width="400" height="400"></canvas>
      </div>
      <button class="spin-btn" id="spinBtn">GIRAR</button>
    </div>

    <!-- Nota final -->
    <p class="disclaimer">
      * Premios v√°lidos por 30 d√≠as. Presenta tu c√≥digo en el restaurante.
    </p>
  </div>

  <script>
    // ===== INICIALIZAR EmailJS =====
    emailjs.init('4KSxHkuk_apCg_kyS');

    // ===== ARREGLO DE PREMIOS =====
    const prizes = [
      { text: "Postre Gratis",   fillStyle: "#caa86f", textFillStyle: "#111" },
      { text: "10% Descuento",   fillStyle: "#111",    textFillStyle: "#f8f8f8" },
      { text: "Caf√© Gratis",     fillStyle: "#caa86f", textFillStyle: "#111" },
      { text: "5% Descuento",    fillStyle: "#111",    textFillStyle: "#f8f8f8" },
      { text: "Bebida Gratis",   fillStyle: "#caa86f", textFillStyle: "#111" },
      { text: "15% Descuento",   fillStyle: "#111",    textFillStyle: "#f8f8f8" }
    ];

    let theWheel;      // Instancia Winwheel
    let userEmail = ""; // Email ingresado

    // ===== 1) VERIFICAR EMAIL Y MOSTRAR RUEDA =====
    function verifyEmail() {
      const emailInput = document.getElementById('userEmail').value.trim();
      if (!emailInput || !emailInput.includes('@') || !emailInput.includes('.')) {
        alert("Por favor, introduce un email v√°lido.");
        return;
      }
      userEmail = emailInput;
      document.getElementById('emailSection').style.display = 'none';
      document.getElementById('wheelSection').style.display = 'block';
      initWheel();
    }

    // ===== 2) INICIALIZAR RUEDA CON Winwheel.js =====
    function initWheel() {
      // Si ya exist√≠a, lo detiene y destruye
      if (theWheel) {
        theWheel.stopAnimation(false);
        theWheel = null;
      }

      // Crear instancia Winwheel
      theWheel = new Winwheel({
        canvasId: 'canvas',
        numSegments: prizes.length,
        outerRadius: 180,
        textFontSize: 16,
        textOrientation: 'vertical',  // <--- Texto bien alineado radialmente
        textAlignment: 'center',
        segments: prizes.map(p => ({
          fillStyle: p.fillStyle,
          text: p.text,
          textFillStyle: p.textFillStyle
        })),
        animation: {
          type: 'spinToStop',
          duration: 5,  // 5 segundos de animaci√≥n
          spins: 8,     // 8 vueltas completas
          callbackFinished: alertPrize
        }
      });
    }

    // ===== 3) CALLBACK: AL TERMINAR GIRO, MOSTRAR PREMIO Y ENVIAR EMAIL =====
    function alertPrize(indicatedSegment) {
      const prizeText = indicatedSegment.text;
      const codigo = 'OP' + Math.floor(Math.random() * 9000 + 1000);
      const fechaValidez = new Date();
      fechaValidez.setDate(fechaValidez.getDate() + 30);
      const fechaStr = fechaValidez.toLocaleDateString('es-ES', {
        day: '2-digit', month: '2-digit', year: 'numeric'
      });

      emailjs.send('service_t4py4c5', 'template_sby6x8j', {
        to_email: userEmail,
        premio: prizeText,
        codigo: codigo,
        fecha: fechaStr
      }).then(() => {
        alert(`üéâ ¬°Felicidades!\nHas ganado: ${prizeText}\nRevisa tu email para tu c√≥digo.`);
      }).catch((error) => {
        // Si falla el env√≠o, mostramos el c√≥digo en alerta
        alert(`üéâ ¬°Felicidades!\nHas ganado: ${prizeText}\nC√≥digo: ${codigo}\n(v√°lido hasta ${fechaStr})`);
      });
    }

    // ===== 4) ASOCIAR BOT√ìN ‚ÄúGIRAR‚Äù =====
    document.getElementById('spinBtn').addEventListener('click', () => {
      document.getElementById('spinBtn').disabled = true;
      theWheel.startAnimation();
      setTimeout(() => {
        document.getElementById('spinBtn').disabled = false;
      }, 5000);
    });
  </script>
</body>
</html>
